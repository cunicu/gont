"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5821],{8040:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>p,frontMatter:()=>c,metadata:()=>r,toc:()=>d});var o=s(4848),t=s(8453);const c={sidebar_position:2},i="Execute code",r={id:"examples/exec",title:"Execute code",description:"Inside the network namespaces / hosts",source:"@site/docs/examples/exec.md",sourceDirName:"examples",slug:"/examples/exec",permalink:"/examples/exec",draft:!1,unlisted:!1,editUrl:"https://github.com/cunicu/gont/edit/main/website/docs/examples/exec.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"docsSidebar",previous:{title:"Networking Topology",permalink:"/examples/topology"},next:{title:"CGroups",permalink:"/examples/cgroups"}},a={},d=[{value:"<code>exec.Cmd</code> API",id:"execcmd-api",level:3},{value:"Pass options",id:"pass-options",level:3},{value:"Pass non-string arguments",id:"pass-non-string-arguments",level:3},{value:"Go functions",id:"go-functions",level:3},{value:"Go packages",id:"go-packages",level:3}];function l(e){const n={admonition:"admonition",code:"code",h1:"h1",h3:"h3",header:"header",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"execute-code",children:"Execute code"})}),"\n",(0,o.jsx)(n.p,{children:"Inside the network namespaces / hosts"}),"\n",(0,o.jsxs)(n.h3,{id:"execcmd-api",children:[(0,o.jsx)(n.code,{children:"exec.Cmd"})," API"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'// Get a exec.Cmd-like struct\ncmd := host1.Command("ping", "host2")\nout, err := cmd.CombinedOutput()\n\n// Directly run a simple process synchronously\ncmd, err := host1.Run("ping", "host2")\n\n// Directly start asynchronously\ncmd, err := host1.Start("ping", "host2")\n\ntime.Sleep(5 * time.Second)\n\nerr = cmd.Process.Signal(os.Interrupt)\ncmd.Wait()\n'})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"gont.Node"})," type implements an API similar to the one provided by Go's\n",(0,o.jsx)(n.code,{children:"exec"})," package."]}),"\n",(0,o.jsx)(n.h3,{id:"pass-options",children:"Pass options"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'import copt "github.com/cunicu/gont/v2/pkg/options/cmd"\n\noutb := &bytes.Buffer{}\n\ncmd := host1.Command("ping", "1.1.1.1",\n  copt.DisableASLR(true),\n  copt.Dir("/custom/working/dir"),\n  copt.EnvVar("DEBUG", "1"),\n  copt.Stdin(...), // pass any io.Reader\n  copt.Stdout(outb), // pass any io.Writer (can be repeated)\n  copt.Stderr(...), // pass any io.Writer (can be repeated)\n)\n\nprint(outb.String())\n'})}),"\n",(0,o.jsx)(n.h3,{id:"pass-non-string-arguments",children:"Pass non-string arguments"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'ip := net.ParseIP("1.1.1.1")\n\ncmd := host1.Command("ping", "-c", 10, "-i", 0.1, ip)\n'})}),"\n",(0,o.jsx)(n.h3,{id:"go-functions",children:"Go functions"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'host1.RunFunc(func() {\n  r := http.Get("http://host2:8080")\n  io.Copy(os.Stdout, r.Body)\n})\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Call a function inside a network namespace of host ",(0,o.jsx)(n.code,{children:"host1"})," but still\nin the same process so you can use channels and access global variables."]}),"\n",(0,o.jsxs)(n.admonition,{type:"warning",children:[(0,o.jsx)(n.p,{children:"Spawning Goroutines from within the callback is only indirectly supported:"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"host1.RunFunc(func() {\n  go host1.RunFunc(func() { ... })\n})\n"})})]}),"\n",(0,o.jsx)(n.h3,{id:"go-packages",children:"Go packages"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'cmd, err := host1.RunGo("test/prog.go", "arg1")\n'})})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>r});var o=s(6540);const t={},c=o.createContext(t);function i(e){const n=o.useContext(c);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),o.createElement(c.Provider,{value:n},e.children)}}}]);