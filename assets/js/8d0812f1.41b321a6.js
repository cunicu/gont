"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[7297],{6428:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>l});var a=s(4848),i=s(8453);const r={},c="Namespaces",t={id:"introduction/namespaces",title:"Namespaces",description:"What are Linux namespaces? They..",source:"@site/docs/introduction/namespaces.md",sourceDirName:"introduction",slug:"/introduction/namespaces",permalink:"/introduction/namespaces",draft:!1,unlisted:!1,editUrl:"https://github.com/cunicu/gont/tree/main/docs/website/docs/introduction/namespaces.md",tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Definitions",permalink:"/introduction/definitions"},next:{title:"Requirements",permalink:"/requirements"}},o={},l=[{value:"Available Linux namespaces",id:"available-linux-namespaces",level:2},{value:"But what exactly is a namespace?",id:"but-what-exactly-is-a-namespace",level:2},{value:"How do I create a namespace?",id:"how-do-i-create-a-namespace",level:2},{value:"unshare(2)",id:"unshare2",level:2},{value:"How do I create a namespace?",id:"how-do-i-create-a-namespace-1",level:2},{value:"How can I share a namespace with other processes?",id:"how-can-i-share-a-namespace-with-other-processes",level:2},{value:"Joining namespace of another process: <code>/proc</code>",id:"joining-namespace-of-another-process-proc",level:2},{value:"Joining namespace of another process: <code>pidfd_open</code>",id:"joining-namespace-of-another-process-pidfd_open",level:2},{value:"Persisting namespaces",id:"persisting-namespaces",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"namespaces",children:"Namespaces"})}),"\n",(0,a.jsx)(n.p,{children:"What are Linux namespaces? They.."}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Partition kernel resources from ",(0,a.jsx)(n.strong,{children:"a process-perspective."})]}),"\n",(0,a.jsx)(n.li,{children:"Power most of Linux containerization tools."}),"\n",(0,a.jsx)(n.li,{children:"Appear in many Linux subsystems."}),"\n",(0,a.jsx)(n.li,{children:"Are used by many sandboxing solutions in browsers."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"available-linux-namespaces",children:"Available Linux namespaces"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"mnt:"})," Mounts"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"pid:"})," Process IDs"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"net:"})," Networking"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"ipc:"})," Interprocess Communication"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"uts:"})," Unix Timesharing (hostname)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"user:"})," User identification & privileges"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"cgroup:"})," Process Control Groups"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"time:"})," System time"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"but-what-exactly-is-a-namespace",children:"But what exactly is a namespace?"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Can be identified by a file descriptor"}),"\n",(0,a.jsx)(n.li,{children:"A namespace can have multiple processes assigned to it"}),"\n",(0,a.jsx)(n.li,{children:"It lives as long as there is still at least one remaining process"}),"\n",(0,a.jsx)(n.li,{children:"Child processes inherit parent namespaces"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"how-do-i-create-a-namespace",children:"How do I create a namespace?"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://man7.org/linux/man-pages/man2/unshare.2.html",children:"unshare(2)"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://man7.org/linux/man-pages/man2/clone.2.html",children:"clone(2)"})}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"unshare2",children:"unshare(2)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-go",children:"func main() {\n  err := syscall.Unshare(syscall.CLONE_NEWNS);\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"how-do-i-create-a-namespace-1",children:"How do I create a namespace?"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-go",children:'static int child(void *arg) {\n  struct utsname uts;\n\n  sethostname(arg, "ernie")\n\n  uname(&uts)\n  printf("nodename in child:  %s\\n", uts.nodename);\n\n  return 0;\n}\n\nint main() {\n  struct utsname uts;\n\n  // Allocate stack for child\n  char *stack = malloc(STACK_SIZE);\n  if (stack == NULL)\n    return -1;\n\n  // Start new kernel task in new UTS namespace\n  pid_t child_pid = clone(child, stack + STACK_SIZE, CLONE_NEWUTS | SIGCHLD, NULL);\n\n  // Output hostname\n  uname(&uts)\n  printf("nodename in parent:  %s\\n", uts.nodename);\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"how-can-i-share-a-namespace-with-other-processes",children:"How can I share a namespace with other processes?"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["By forking with\n",(0,a.jsx)(n.a,{href:"https://man7.org/linux/man-pages/man2/clone.2.html",children:"clone(2)"})]}),"\n",(0,a.jsxs)(n.li,{children:["By passing file descriptor and\n",(0,a.jsx)(n.a,{href:"https://man7.org/linux/man-pages/man2/setns.2.html",children:"setns(2)"})]}),"\n"]}),"\n",(0,a.jsxs)(n.h2,{id:"joining-namespace-of-another-process-proc",children:["Joining namespace of another process: ",(0,a.jsx)(n.code,{children:"/proc"})]}),"\n",(0,a.jsxs)(n.p,{children:["You can join the namespace of another process by using ",(0,a.jsx)(n.a,{href:"https://man7.org/linux/man-pages/man5/proc.5.html",children:"/proc/{pid}/ns/*"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-go",children:'fd := syscall.Open("/proc/1234/ns/uts", syscall.O_RDONLY);\nerr := unix.Setns(fd, syscall.CLONE_NEWUTS);\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Note:"})," Can only set a single namespace per ",(0,a.jsx)(n.code,{children:"netns(2)"})," invocation."]}),"\n",(0,a.jsxs)(n.h2,{id:"joining-namespace-of-another-process-pidfd_open",children:["Joining namespace of another process: ",(0,a.jsx)(n.code,{children:"pidfd_open"})]}),"\n",(0,a.jsxs)(n.p,{children:["You can join the namespace of another process by using ",(0,a.jsx)(n.a,{href:"https://man7.org/linux/man-pages/man2/pidfd_open.2.html",children:"pidfd_open(2)"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-go",children:"pid_t pid = 1234;\nint fd = pidfd_open(pid, 0);\n\nsetns(fd, CLONE_NEWUTS | CLONE_NEWNET);\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Note:"})," Can only set a multiple namespaces per ",(0,a.jsx)(n.code,{children:"netns(2)"})," invocation."]}),"\n",(0,a.jsx)(n.h2,{id:"persisting-namespaces",children:"Persisting namespaces"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-go",children:'err := syscall.Mount("/proc/self/ns/uts",\n                     "/home/acs/my_uts_namespace", "", syscall.MS_BIND, nil);\n'})}),"\n",(0,a.jsx)(n.p,{children:"And in another process..."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-go",children:'fd := syscall.Open("/home/acs/my_uts_namespace", syscall.O_RDONLY);\nerr := unix.Setns(fd, syscall.CLONE_NEWUTS);\n'})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>t});var a=s(6540);const i={},r=a.createContext(i);function c(e){const n=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);